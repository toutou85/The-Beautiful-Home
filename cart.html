<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>سلة المشتريات</title>
  <style>
    body { font-family: Tahoma; padding: 1rem; background: #f2f2f2; }
    h2 { text-align: center; color: #005f73; }
    .item { background: #fff; border-radius: 8px; padding: 10px; margin-bottom: 10px; box-shadow: 0 0 5px #ccc; display: flex; gap: 10px; align-items: center; }
    .item img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; }
    .item-details { flex: 1; }
    .quantity-control { display: flex; gap: 5px; align-items: center; }
    button { cursor: pointer; background: #0a9396; color: white; border: none; padding: 6px 10px; border-radius: 5px; font-size: 1rem; }
    .delete-btn { background: #c1121f; }
  </style>
</head>
<body>

<h2>🛒 سلة المشتريات</h2>
<div id="cartItems"></div>

<button onclick="checkout()">✅ شراء</button>

<script>
let cart = JSON.parse(localStorage.getItem("cart") || "[]");

function renderCart() {
  const container = document.getElementById("cartItems");
  if (cart.length === 0) {
    container.innerHTML = "<p>❌ السلة فارغة</p>";
    return;
  }

  container.innerHTML = "";
  cart.forEach((item, index) => {
    if (!item.quantity) item.quantity = 1;

    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <img src="${item.image}" alt="${item.name}">
      <div class="item-details">
        <strong>${item.name}</strong><br>
        السعر: ${item.price} دج<br>
        <div class="quantity-control">
          <button onclick="changeQty(${index}, -1)">➖</button>
          <span>${item.quantity}</span>
          <button onclick="changeQty(${index}, 1)">➕</button>
        </div>
        <button class="delete-btn" onclick="removeItem(${index})">🗑 حذف</button>
      </div>
    `;
    container.appendChild(div);
  });
}

function changeQty(index, delta) {
  cart[index].quantity += delta;
  if (cart[index].quantity < 1) cart[index].quantity = 1;
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function removeItem(index) {
  cart.splice(index, 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function checkout() {
  if (cart.length === 0) {
    alert("⚠️ لا يوجد منتجات!");
    return;
  }

  let productSummary = "";
  let totalPrice = 0;
  let totalQty = 0;

  cart.forEach((item, i) => {
    productSummary += (i > 0 ? " + " : "") + `${item.name} × ${item.quantity}`;
    totalPrice += item.price * item.quantity;
    totalQty += item.quantity;
  });

  // حفظ المعلومات مؤقتًا في localStorage
  localStorage.setItem("checkout", JSON.stringify({
    summary: productSummary,
    totalPrice: totalPrice,
    totalQty: totalQty
  }));

  window.location.href = "order.html";
}

renderCart();
</script>

</body>
</html>