<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>نموذج الطلب</title>
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 1rem;
    }
    h2 {
      text-align: center;
      color: #005f73;
    }
    form {
      background: white;
      max-width: 500px;
      margin: auto;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, select, textarea {
      width: 100%;
      padding: 0.6rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }
    #phoneGroup {
      display: flex;
      gap: 10px;
    }
    #phoneGroup select {
      width: 30%;
    }
    #phoneGroup input {
      width: 70%;
    }
    button {
      background-color: #0a9396;
      color: white;
      padding: 0.7rem 1.5rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }
    #loadingMessage {
      text-align: center;
      font-size: 1.2rem;
      color: #0077aa;
      animation: pulse 1s infinite;
      margin-bottom: 1rem;
    }
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>

<h2>نموذج الطلب</h2>

<form id="orderForm">
  <input type="text" name="name" placeholder="الاسم واللقب" required>

  <div id="phoneGroup">
    <select id="prefix" required>
      <option value="05">05</option>
      <option value="06">06</option>
      <option value="07">07</option>
    </select>
    <input type="tel" id="phoneBody" maxlength="8" pattern="^[0-9]{8}$" placeholder="ادخل رقم الهاتف xxxxxxxx" required>
  </div>
  <input type="hidden" name="phone" id="phoneFull">

  <select name="wilaya" required>
    <option value="">اختر ولايتك</option>
  <option>أدرار</option>
  <option>الشلف</option>
  <option>الأغواط</option>
  <option>أم البواقي</option>
  <option>باتنة</option>
  <option>بجاية</option>
  <option>بسكرة</option>
  <option>بشار</option>
  <option>البليدة</option>
  <option>البويرة</option>
  <option>تمنراست</option>
  <option>تبسة</option>
  <option>تلمسان</option>
  <option>تيارت</option>
  <option>تيزي وزو</option>
  <option>الجزائر</option>
  <option>الجلفة</option>
  <option>جيجل</option>
  <option>سطيف</option>
  <option>سعيدة</option>
  <option>سكيكدة</option>
  <option>سيدي بلعباس</option>
  <option>عنابة</option>
  <option>قالمة</option>
  <option>قسنطينة</option>
  <option>المدية</option>
  <option>مستغانم</option>
  <option>المسيلة</option>
  <option>معسكر</option>
  <option>ورقلة</option>
  <option>وهران</option>
  <option>البيض</option>
  <option>إليزي</option>
  <option>برج بوعريريج</option>
  <option>بومرداس</option>
  <option>الطارف</option>
  <option>تندوف</option>
  <option>تيسمسيلت</option>
  <option>الوادي</option>
  <option>خنشلة</option>
  <option>سوق أهراس</option>
  <option>تيبازة</option>
  <option>ميلة</option>
  <option>عين الدفلى</option>
  <option>النعامة</option>
  <option>عين تموشنت</option>
  <option>غرداية</option>
  <option>غليزان</option>
  <option>تميمون</option>
  <option>برج باجي مختار</option>
  <option>أولاد جلال</option>
  <option>بني عباس</option>
  <option>عين صالح</option>
  <option>عين قزام</option>
  <option>تقرت</option>
  <option>جانت</option>
  <option>المغير</option>
  <option>المنيعة</option>
</select>

  <textarea name="address" placeholder="العنوان الكامل بالتفصيل" required></textarea>
  <textarea name="notes" placeholder="ملاحظات إضافية (اختياري)"></textarea>

  <input type="text" name="product" id="productInput" readonly placeholder="نوع المنتج">
  <input type="number" name="price" id="priceInput" readonly placeholder="سعر المنتج">
  <input type="number" name="quantity" id="quantityInput" placeholder="الكمية" min="1" value="1" required>
  <input type="text" name="total" id="totalPrice" placeholder="المجموع الكلي" readonly>

  <div id="loadingMessage" style="display:none">⏳ فضلاً انتظر... استغفر الله العظيم</div>

  <button type="submit">تأكيد الطلب</button>
</form>

<script>
  // استقبال بيانات المنتج من الرابط
  const urlParams = new URLSearchParams(window.location.search);
  const product = urlParams.get("product");
  const price = urlParams.get("price");

  if (product && price) {
    document.getElementById("productInput").value = product;
    document.getElementById("priceInput").value = price;
    document.getElementById("quantityInput").value = 1;
    calculateTotal();
  }

  document.getElementById("quantityInput").addEventListener("input", calculateTotal);

  function calculateTotal() {
    const price = parseInt(document.getElementById("priceInput").value || 0);
    const qty = parseInt(document.getElementById("quantityInput").value || 1);
    const total = price * qty;
    document.getElementById("totalPrice").value = total + " دج";
  }

  // إرسال النموذج
  document.getElementById("orderForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const prefix = document.getElementById("prefix").value;
    const phoneBody = document.getElementById("phoneBody").value.trim();

    if (!/^[0-9]{8}$/.test(phoneBody)) {
      alert("⚠️ يرجى إدخال 8 أرقام صحيحة بعد البادئة.");
      return;
    }

    const fullPhone = prefix + phoneBody;
    document.getElementById("phoneFull").value = fullPhone;

    document.getElementById("loadingMessage").style.display = "block";

    const formData = new FormData(this);
    const scriptURL = "https://script.google.com/macros/s/AKfycby8j70Q8Ybnvgt7F14RKwrn3ngd6cg2Ksaz4aE1NY_bmfe-Abq9ZinizHWKesyU5xDb/exec"; // <-- غيّر الرابط حسب سكربتك

    fetch(scriptURL, {
      method: "POST",
      body: formData
    })
    .then(() => {
      window.location.href = `myorders.html?phone=${fullPhone}`;
    })
    .catch(() => {
      alert("❌ حدث خطأ أثناء الإرسال.");
      document.getElementById("loadingMessage").style.display = "none";
    });
  });
</script>

</body>
</html>